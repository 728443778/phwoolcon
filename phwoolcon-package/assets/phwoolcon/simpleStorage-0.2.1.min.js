!function(e,t){"use strict";"function"==typeof define&&define.amd?define(t):"undefined"!=typeof exports?module.exports=t():e.simpleStorage=t()}(this,function(){"use strict";function e(){S=m(),a(),n(),t(),"addEventListener"in window&&window.addEventListener("pageshow",function(e){e.persisted&&r()},!1),S=!0}function t(){"addEventListener"in window?window.addEventListener("storage",r,!1):document.attachEvent("onstorage",r)}function r(){try{a()}catch(e){return void(S=!1)}n()}function a(){var e=localStorage.getItem("simpleStorage");try{c=JSON.parse(e)||{}}catch(t){c={}}T=i()}function o(){try{localStorage.setItem("simpleStorage",JSON.stringify(c)),T=i()}catch(e){return l(e)}return!0}function i(){var e=localStorage.getItem("simpleStorage");return e?String(e).length:0}function n(){var e,t,r,a,i,_=1/0,m=0;if(clearTimeout(u),c&&c.__simpleStorage_meta&&c.__simpleStorage_meta.TTL){for(e=+new Date,i=c.__simpleStorage_meta.TTL.keys||[],a=c.__simpleStorage_meta.TTL.expire||{},t=0,r=i.length;r>t;t++){if(!(a[i[t]]<=e)){a[i[t]]<_&&(_=a[i[t]]);break}m++,delete c[i[t]],delete a[i[t]]}_!==1/0&&(u=setTimeout(n,Math.min(_-e,2147483647))),m&&(i.splice(0,m),s(),o())}}function _(e,t){var r,a,o=+new Date,i=!1;if(t=Number(t)||0,0!==t){if(!c.hasOwnProperty(e))return!1;if(c.__simpleStorage_meta||(c.__simpleStorage_meta={}),c.__simpleStorage_meta.TTL||(c.__simpleStorage_meta.TTL={expire:{},keys:[]}),c.__simpleStorage_meta.TTL.expire[e]=o+t,c.__simpleStorage_meta.TTL.expire.hasOwnProperty(e))for(r=0,a=c.__simpleStorage_meta.TTL.keys.length;a>r;r++)c.__simpleStorage_meta.TTL.keys[r]===e&&c.__simpleStorage_meta.TTL.keys.splice(r);for(r=0,a=c.__simpleStorage_meta.TTL.keys.length;a>r;r++)if(c.__simpleStorage_meta.TTL.expire[c.__simpleStorage_meta.TTL.keys[r]]>o+t){c.__simpleStorage_meta.TTL.keys.splice(r,0,e),i=!0;break}i||c.__simpleStorage_meta.TTL.keys.push(e)}else if(c&&c.__simpleStorage_meta&&c.__simpleStorage_meta.TTL){if(c.__simpleStorage_meta.TTL.expire.hasOwnProperty(e))for(delete c.__simpleStorage_meta.TTL.expire[e],r=0,a=c.__simpleStorage_meta.TTL.keys.length;a>r;r++)if(c.__simpleStorage_meta.TTL.keys[r]===e){c.__simpleStorage_meta.TTL.keys.splice(r,1);break}s()}return clearTimeout(u),c&&c.__simpleStorage_meta&&c.__simpleStorage_meta.TTL&&c.__simpleStorage_meta.TTL.keys.length&&(u=setTimeout(n,Math.min(Math.max(c.__simpleStorage_meta.TTL.expire[c.__simpleStorage_meta.TTL.keys[0]]-o,0),2147483647))),!0}function s(){var e,t=!1,r=!1;if(!c||!c.__simpleStorage_meta)return t;c.__simpleStorage_meta.TTL&&!c.__simpleStorage_meta.TTL.keys.length&&(delete c.__simpleStorage_meta.TTL,t=!0);for(e in c.__simpleStorage_meta)if(c.__simpleStorage_meta.hasOwnProperty(e)){r=!0;break}return r||(delete c.__simpleStorage_meta,t=!0),t}function m(){var e,t=0;if(null===window.localStorage||"unknown"==typeof window.localStorage)throw e=new Error("localStorage is disabled"),e.code=w,e;if(!window.localStorage)throw e=new Error("localStorage not supported"),e.code=f,e;try{t=window.localStorage.length}catch(r){throw l(r)}try{window.localStorage.setItem("__simpleStorageInitTest",(+new Date).toString(16)),window.localStorage.removeItem("__simpleStorageInitTest")}catch(r){throw t?l(r):(e=new Error("localStorage is disabled"),e.code=w,e)}return!0}function l(e){var t;return 22===e.code||1014===e.code||[-2147024882,-2146828281,-21474675259].indexOf(e.number)>0?(t=new Error("localStorage quota exceeded"),t.code=L,t):18===e.code||1e3===e.code?(t=new Error("localStorage is disabled"),t.code=w,t):"TypeError"===e.name?(t=new Error("localStorage is disabled"),t.code=w,t):e}function p(e){if(!e)return d="OK",e;switch(e.code){case f:case w:case L:d=e.code;break;default:d=e.code||e.number||e.message||e.name}return e}var g="0.2.1",c=!1,T=0,S=!1,u=null,d="OK",f="LS_NOT_AVAILABLE",w="LS_DISABLED",L="LS_QUOTA_EXCEEDED";try{e()}catch(h){p(h)}return{version:g,status:d,canUse:function(){return"OK"===d&&!!S},set:function(e,t,r){if("__simpleStorage_meta"===e)return!1;if(!c)return!1;if("undefined"==typeof t)return this.deleteKey(e);r=r||{};try{t=JSON.parse(JSON.stringify(t))}catch(a){return l(a)}return c[e]=t,_(e,r.TTL||0),o()},hasKey:function(e){return c?!(!c.hasOwnProperty(e)||"__simpleStorage_meta"===e):!1},get:function(e){return c?c.hasOwnProperty(e)&&"__simpleStorage_meta"!==e&&this.getTTL(e)?c[e]:void 0:!1},deleteKey:function(e){return c&&e in c?(delete c[e],_(e,0),o()):!1},setTTL:function(e,t){return c?(_(e,t),o()):!1},getTTL:function(e){var t;return c&&c.hasOwnProperty(e)?c.__simpleStorage_meta&&c.__simpleStorage_meta.TTL&&c.__simpleStorage_meta.TTL.expire&&c.__simpleStorage_meta.TTL.expire.hasOwnProperty(e)?(t=Math.max(c.__simpleStorage_meta.TTL.expire[e]-+new Date||0,0),t||!1):1/0:!1},flush:function(){if(!c)return!1;c={};try{return localStorage.removeItem("simpleStorage"),!0}catch(e){return l(e)}},index:function(){if(!c)return!1;var e,t=[];for(e in c)c.hasOwnProperty(e)&&"__simpleStorage_meta"!==e&&t.push(e);return t},storageSize:function(){return T}}});